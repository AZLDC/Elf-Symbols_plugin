# 新注音繁簡快速切換（非官方）

透過熱鍵與系統托盤圖示，在 Windows 的微軟「新注音」輸入法中快速切換「繁體／簡體輸出」模式。

本工具會讀寫目前使用者登錄檔中的 `Enable Simplified Chinese Output`，並同步更新托盤圖示與提示文字。

![陸地鍵仙意象圖](./陸地鍵仙.png)

## 非官方聲明
本專案為社群工具，非 Microsoft 官方產品，與 Microsoft 無隸屬、合作或背書關係。

---

## 功能一覽
- 熱鍵切換：Alt、Alt、W（需在 0.5 秒內完成）
- 托盤切換：滑鼠左鍵點擊托盤圖示即可切換
- 托盤選單：滑鼠右鍵開啟選單並可結束程式
- 狀態顯示：托盤提示文字顯示目前輸出模式與快捷說明
- 自動偵測登錄路徑：嘗試尋找可用的新注音（IME）登錄路徑並確保必要鍵值存在
- 立即生效：寫入後會切換到英文輸入法再切回新注音，促使新狀態立即套用

## 運行狀態示意

![托盤狀態預覽](./運行圖.jpg)

1. **左圖：繁體輸出** – 托盤圖示顯示「繁」，提示文字會寫上「繁體輸出」，代表目前所有輸入都會以繁體呈現。
2. **中圖：簡體輸出** – 圖示切換為「簡」，提示文字同步顯示「簡體輸出」，確認已改為簡體模式。
3. **右圖：其他語系提示** – 圖示上的「轉」被禁止符號覆蓋，代表切換到其他語系（如日文鍵盤）時不提供繁簡轉換，因為這些語系本身沒有繁簡輸出需求。

---

## 工作原理（簡述）
1. 讀取/寫入登錄值：`Enable Simplified Chinese Output`
2. 更新托盤圖示與提示文字（繁 / 簡 / 切換中）
3. 觸發輸入法刷新：切到英文輸入法再切回新注音，讓輸出模式立刻生效

---

## 系統需求
- Windows 10 / 11
- 已安裝微軟「新注音／注音」輸入法
- Python 3.8 以上
- 依賴套件：`keyboard`

---

## 快速開始（推薦）

### 方式 A：讓 `.pyw` 點兩下就能執行
1. 在檔案總管找到任一個 `.pyw`（例如 `Elf-Symbols_plugin.pyw`）。
2. 右鍵該檔案 →「開啟檔案」→「選擇其他應用程式」。
   - 小提醒：選單上是「開啟檔案」，不是「開啟」。
3. 選擇 `pythonw.exe`（GUI 執行檔）。
   - 常見位置示例：`C:\Python312\pythonw.exe`
4. 勾選「一律使用此應用程式開啟 .pyw 檔案」→「確定」。
5. 設定完成後，`.pyw` 檔案即可直接點兩下執行。

### 方式 B：用批次檔 `run.bat` 啟動
1. 將 `run.bat` 與 `Elf-Symbols_plugin.pyw` 放在同一資料夾。
2. 點兩下 `run.bat`。
3. `run.bat` 會嘗試用 `py -3` 執行腳本。
   - 若找不到 `py.exe` 會顯示提示並結束。

---

## 檔案清單
請確認下列檔案位於同一資料夾：
- `Elf-Symbols_plugin.pyw`
- `繁.png`、`簡.png`、`轉.png`
- `run.bat`（選用）
- `Cursors_FIX.py`（選用，若移除則停用游標修復背景程序）

### Cursors_FIX.py 是什麼？
- 功能：自 Windows 10 1809 起，只要游標在「一般 ↔ 忙碌 ↔ 氣泡」等不同狀態間切換，就容易讓動畫游標卡死不更新；此腳本啟動後會固定以「替換為靜態游標 → 重新載入方案」的方式強制初始化，作為唯一可靠的補救措施。
- 觸發條件：只要`Cursors_FIX.py`檔案存在，同資料夾的 `Elf-Symbols_plugin.pyw` 會在啟動時自動載入並執行背景監控緒。
- 移除行為：若刪除或搬走 `Cursors_FIX.py`，主程式會偵測不到檔案而略過啟動，依然正常執行、不會報錯。
- 關閉流程：程式結束時會自動通知背景緒收攤，確保不殘留任何游標修復執行緒。

---

## 安裝依賴
若首次執行顯示缺少模組，請先安裝依賴後再啟動：
```bash
py -3 -m pip install keyboard
```

---

## 使用方式
### 啟動後會做的事
- 讀取登錄檔並顯示目前輸出模式
- 以 Win32 API 建立原生托盤視窗並載入 PNG 圖示
- 監聽熱鍵：Alt、Alt、W（需在 0.5 秒內完成）

### 切換方式
- 熱鍵：連按兩次 Alt，接著在 0.5 秒內按 W
- 托盤：滑鼠左鍵點擊托盤圖示即可切換
- 退出：滑鼠右鍵開啟選單可關閉程式

### 關閉方式
![托盤選單示意（關閉APP）](./關.png)
1. 先在 Windows 通知區確認托盤圖示是哪一個（圖示會依模式顯示「繁／簡／轉」）。
2. 以滑鼠右鍵點擊圖示，展開功能選單。
3. 點選選單中的「關閉APP」即可結束托盤程式，托盤圖示會立即移除；若 `Cursors_FIX.py` 由主程式啟動，會在同一時間收到停止訊號並一併關閉。

---

## 注意事項
- 本工具透過 `keyboard` 套件安裝全域鍵盤 hook。若目前焦點程式以更高完整性層級（例如系統管理員權限）執行，Windows 會阻擋較低權限程式讀取其鍵盤事件，可能造成 Alt-Alt-W 熱鍵完全無反應。這是作業系統為了保護高權限應用程式而設計的限制，並非本工具錯誤。建議保持前景程式與本工具皆以一般權限執行；若確實需要在高權限程式內使用熱鍵，請評估風險後再調整兩者權限等級。

---

## 隱私與安全
- 本工具使用全域鍵盤事件偵測熱鍵序列（僅用於判斷 Alt、Alt、W）。
- 本工具不會將任何鍵入內容寫入檔案，不會上傳資料，不會連網。

---

## 常見問題（FAQ）
### 1) 熱鍵無效或偶爾失效
- 某些程式會攔截 Alt 鍵或熱鍵序列，可能導致事件無法被正確偵測。
- 若前景程式以系統管理員權限執行，可能造成不同完整性層級而使熱鍵偵測失效。可嘗試以相同權限執行本工具，或避免在提升權限的前景程式內使用熱鍵。

### 2) 托盤圖示顯示異常 / 沒有圖示
- 確認 `繁.png`、`簡.png`、`轉.png` 與 `Elf-Symbols_plugin.pyw` 位於同一資料夾。
- 若你移動了腳本位置，請一併移動 PNG 圖示。

### 3) 切換後沒有立刻生效
- 本工具會嘗試切到英文輸入法再切回新注音以促使立即生效。
- 若仍未生效，請確認當前正在使用的是「新注音／注音」輸入法，並嘗試重新啟動工具。

---

## 設計初衷
其實就是我平時工作有被要求需要直面客戶，需要和對岸的客戶溝通，但同時又要和這邊的同事溝通。<br>
而我們各自都有自己的閱讀習慣，對岸的人不喜歡看我們的繁體，我也用不慣拼音。<br>
公司內部和我自己習慣也是使用繁體中文，但是新注音的繁簡切換雖然不麻煩，但每次都要進設定去調整。<br>
每當需要頻繁調整時，些微的煩躁感就慢慢的在一點點的累積。<br>
香港那邊的輸入法就有繁簡快速切換快速鍵，注音就沒有，但微軟完全無視我們這個需求。<br>
我提過，但對面給的回應卻是"需求比例較低"、"不影響使用"、"優先權低"，請不要抱持希望，因為工作即使進入排程，排程順序將很可能無限往後順延。<br>
好吧，我自己做。<br>
<div align="right">-- by AZLDC</div>

---

## License
Apache License 2.0

## Third-Party Notices
本專案使用第三方套件 `keyboard`，其授權以該套件原始授權為準.